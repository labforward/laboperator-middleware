#!/usr/bin/env node
/* eslint-disable import/no-dynamic-require */

const nodemon = require('nodemon');
const path = require('path');

const script = path.resolve(__dirname, '../src/cli');

const args = require('../src/cli/args');

args({
  default: () => require(script),
  server: (argv) => {
    if (argv.watch) {
      nodemon({
        script,
        ext: 'js',
        args: process.argv.slice(2),
      });

      nodemon
        .on('quit', () => {
          process.exit();
        })
        .on('restart', (files) => {
          /* eslint-disable-next-line no-console */
          console.log('Server restarted, changes detected: ', files);
        });
    } else {
      require(script);
    }
  },
});
